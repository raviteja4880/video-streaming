import{r as d,u as b,j as t,b as N,v as u,F as v,c as h,A as o}from"./index-DyDKpjxL.js";function $(){const[n,l]=d.useState([]),[y,x]=d.useState(!0),c=b(),m=async()=>{try{const{data:e}=await h.get("/history");l(e)}catch{o.error("Failed to load history")}finally{x(!1)}};d.useEffect(()=>{m();const e=setInterval(m,1e5);return()=>clearInterval(e)},[]);const g=async e=>{try{await h.delete(`/history/item/${e}`),l(s=>s.filter(a=>a._id!==e))}catch{o.error("Failed to remove video")}},j=async()=>{if(window.confirm("Clear your entire watch history?"))try{await h.delete("/history"),l([])}catch{o.error("Failed to clear history")}},w=e=>{const s=e.videoId||{},a=e.totalDuration?e.watchedSeconds/e.totalDuration*100:0,i=s._id||e.videoId;if(!i){o.warn("Video not available.");return}a>5&&a<95?window.confirm(`Resume "${s.title}" from ${Math.floor(e.watchedSeconds/60)}m ${Math.floor(e.watchedSeconds%60)}s?`)?c(`/video/${i}?resume=${e.watchedSeconds}`):c(`/video/${i}`):c(`/video/${i}`)};return y?t.jsx("div",{className:"container text-light text-center py-5",children:"Loading your watch history..."}):t.jsxs("div",{className:"container history-page py-5",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[t.jsxs("h3",{className:"text-light mb-0 d-flex align-items-center gap-2",children:[t.jsx(N,{})," Watch History"]}),n.length>0&&t.jsxs("button",{className:"btn btn-danger btn-sm clear-btn",onClick:j,children:[t.jsx(u,{className:"me-2"})," Clear All"]})]}),n.length===0?t.jsx("div",{className:"text-center text-secondary mt-5",children:t.jsx("p",{children:"No videos watched yet."})}):t.jsx("div",{className:"history-grid",children:n.map(e=>{const s=e.videoId||{},a=s.title||e.title||"Untitled Video",i=e.thumbnail||s.thumbnail||"/assets/default-thumbnail.jpg",f=s.url||e.url,r=e.totalDuration>0?e.watchedSeconds/e.totalDuration*100:0;return t.jsxs("div",{className:"history-card",children:[t.jsxs("div",{className:"thumb-wrapper position-relative",onClick:()=>w(e),children:[t.jsx("video",{src:f,muted:!0,poster:i,className:"history-thumb"}),t.jsx("div",{className:"thumb-overlay",children:t.jsxs("span",{children:[t.jsx(v,{className:"me-2"}),r>0&&r<95?"Resume Watching":"Watch Again"]})}),r>0&&t.jsx("div",{className:"watch-progress",style:{width:`${Math.min(r,100)}%`}}),t.jsx("button",{className:"remove-btn",title:"Remove from history",onClick:p=>{p.stopPropagation(),g(e._id)},children:t.jsx(u,{})})]}),t.jsxs("div",{className:"history-meta",children:[t.jsx("h6",{className:"video-title mb-1",children:a}),t.jsxs("small",{children:["Watched on"," ",new Date(e.watchedAt).toLocaleDateString()," at"," ",new Date(e.watchedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},e._id)})})]})}export{$ as default};
