import{C as J,r as n,u as M,j as e,H as _,I as z,J as $,K as q,v as K,M as T,N as H,A as t,b as f}from"./index-B8jYU2_8.js";function G(){const{user:a,setUser:g,logout:A}=J(),[x,y]=n.useState((a==null?void 0:a.name)||""),[m,h]=n.useState((a==null?void 0:a.avatar)||""),[w,C]=n.useState((a==null?void 0:a.bio)||""),[u,c]=n.useState(!1),[v,p]=n.useState("none"),[S,k]=n.useState(""),[P,U]=n.useState(""),[b,i]=n.useState(!1),N=n.useRef(null),E=M();n.useEffect(()=>{y((a==null?void 0:a.name)||""),h((a==null?void 0:a.avatar)||""),C((a==null?void 0:a.bio)||"")},[a]),n.useEffect(()=>{const s=r=>{N.current&&!N.current.contains(r.target)&&i(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const F=()=>i(!b),I=async s=>{const r=s.target.files[0];if(!r)return;c(!0);let l=t.loading("Starting upload...");try{const o=new FormData;o.append("avatar",r);const B=localStorage.getItem("token"),{data:j}=await f.post("/users/me/avatar",o,{headers:{Authorization:`Bearer ${B}`,"Content-Type":"multipart/form-data"},onUploadProgress:d=>{const D=Math.round(d.loaded*100/d.total);t.update(l,{render:`Uploading avatar... ${D}%`,type:"info",isLoading:!0})}});if(j.success){const d={...a,avatar:j.avatar};localStorage.setItem("user",JSON.stringify(d)),g(d),h(j.avatar),t.update(l,{render:"Avatar uploaded successfully",type:"success",isLoading:!1,autoClose:2500})}else t.update(l,{render:"Upload failed",type:"error",isLoading:!1,autoClose:3e3})}catch{t.update(l,{render:"Error during upload",type:"error",isLoading:!1,autoClose:3e3})}finally{c(!1)}},O=async()=>{t.info(e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2",children:"Remove your avatar?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-danger",onClick:async()=>{t.dismiss();try{const{data:s}=await f.delete("/users/me/avatar");if(s.success){t.success("Avatar removed");const r={...a,avatar:null};localStorage.setItem("user",JSON.stringify(r)),g(r),h("")}}catch{t.error("Failed to remove avatar")}},children:"Yes, remove"}),e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>t.dismiss(),children:"Cancel"})]})]}),{autoClose:!1,position:"top-center",theme:"dark"})},L=async s=>{s.preventDefault(),c(!0);try{const{data:r}=await f.put("/users/me",{name:x,bio:w});localStorage.setItem("user",JSON.stringify(r)),g(r),t.success("Profile updated"),p("none")}catch{t.error("Update failed")}finally{c(!1)}},R=async s=>{var r,l;s.preventDefault(),c(!0);try{const{data:o}=await f.put("/users/me",{currentPassword:S,newPassword:P});t.success(o.message||"Password updated"),k(""),U(""),p("none")}catch(o){t.error(((l=(r=o.response)==null?void 0:r.data)==null?void 0:l.message)||"Password update failed")}finally{c(!1)}};return e.jsx("div",{className:"profile-page",children:e.jsxs("div",{className:"profile-card shadow-lg position-relative",children:[e.jsxs("div",{ref:N,children:[e.jsx("button",{className:`gear-toggle ${b?"rotating":""}`,onClick:F,children:e.jsx(_,{size:20})}),b&&e.jsxs("div",{className:"floating-menu animate__animated animate__fadeInRight",children:[e.jsxs("button",{className:"menu-btn",onClick:()=>{p("edit"),i(!1)},children:[e.jsx(z,{className:"me-2"})," Edit Profile"]}),e.jsxs("button",{className:"menu-btn",onClick:()=>{p("password"),i(!1)},children:[e.jsx($,{className:"me-2"})," Change Password"]}),e.jsxs("button",{className:"menu-btn",onClick:()=>{document.getElementById("avatarUpload").click(),i(!1)},children:[e.jsx(q,{className:"me-2"})," ",m?"Update Avatar":"Upload Avatar"]}),m&&e.jsxs("button",{className:"menu-btn text-danger",onClick:()=>{O(),i(!1)},children:[e.jsx(K,{className:"me-2"})," Remove Avatar"]}),e.jsx("hr",{className:"text-secondary"}),e.jsxs("button",{className:"menu-btn text-danger",onClick:()=>{A(),E("/")},children:[e.jsx(T,{className:"me-2"})," Logout"]})]})]}),e.jsx("input",{id:"avatarUpload",type:"file",accept:"image/*",onChange:I,style:{display:"none"}}),e.jsxs("div",{className:"profile-header text-center mt-3",children:[m?e.jsx("img",{src:m,alt:"avatar",className:"profile-avatar"}):e.jsx(H,{size:80,className:"text-secondary",style:{background:"#222",borderRadius:"50%",padding:"6px"},onClick:()=>document.getElementById("avatarUpload").click()}),e.jsx("h4",{className:"profile-name mt-2",children:x}),e.jsx("small",{className:"text-secondary",children:a==null?void 0:a.email})]}),v==="edit"&&e.jsxs("form",{onSubmit:L,className:"profile-form mt-4",children:[e.jsx("h6",{className:"text-light mb-3",children:"Edit Profile"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{className:"form-control bg-dark text-light border-secondary",value:x,onChange:s=>y(s.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Bio"}),e.jsx("textarea",{className:"form-control bg-dark text-light border-secondary",rows:"3",value:w,onChange:s=>C(s.target.value)})]}),e.jsx("button",{className:"btn btn-primary w-100",disabled:u,children:u?"Saving...":"Save Changes"})]}),v==="password"&&e.jsxs("form",{onSubmit:R,className:"mt-4",children:[e.jsx("h6",{className:"text-light mb-3",children:"Change Password"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Current Password"}),e.jsx("input",{type:"password",className:"form-control bg-dark text-light border-secondary",value:S,onChange:s=>k(s.target.value),required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"New Password"}),e.jsx("input",{type:"password",className:"form-control bg-dark text-light border-secondary",value:P,onChange:s=>U(s.target.value),required:!0})]}),e.jsx("button",{className:"btn btn-warning w-100",disabled:u,children:u?"Updating...":"Update Password"})]}),v==="none"&&e.jsx("p",{className:"text-secondary text-center mt-4 small",children:"Use the ⚙️ toggle to manage your profile"})]})})}export{G as default};
